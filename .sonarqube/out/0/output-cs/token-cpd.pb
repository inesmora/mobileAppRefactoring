ä3
x/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/CameraController.cs
public 
class 
CameraController 
: 
MonoBehaviour  -
{ 
public 

bool 
frontFacing 
; 
public 

PrincipalView 
pv 
; 
public 

UpdateImage 
ui 
;  
SingletonPreferences 
sp 
; 
public 

Picture 
p 
; 
public 

CameraModel 
cm 
; 
public 

RawImage 

background 
; 
private 
Texture 
defaultBackground %
;% &
private 
WebCamTexture 
webCamTexture '
;' (
public 

AspectRatioFitter 
fit  
;  !
public 

RawImage 
	seeingImg 
; 
string 

filePath 
; 
float   	
ratio  
 
,   
scaleY   
;   
int!! 
orient!! 
;!! 
void$$ 
Start$$	 
($$ 
)$$ 
{%% 
filePath&& 
=&& 
Application&& 
.&& 
persistentDataPath&& 1
+&&2 3
$str&&4 E
;&&E F
sp'' 

=''  
SingletonPreferences'' !
.''! "
Instance''" *
;''* +
cm** 

.**
 
setParameters** 
(** 

background** #
,**# $
fit**% (
,**( )
	seeingImg*** 3
,**3 4
frontFacing**5 @
)**@ A
;**A B
webCamTexture++ 
=++ 
cm++ 
.++ 

InitCamera++ %
(++% &
)++& '
;++' (
},, 
void// 
Update//	 
(// 
)// 
{00 
cm22 

.22
 
UpdateCamera22 
(22 
)22 
;22 
}33 
public66 

void66 
	BackToCam66 
(66 
)66 
{77 
pv88 

.88
 
	BackToCam88 
(88 
webCamTexture88 "
)88" #
;88# $
}99 
public;; 

void;; 

closePanel;; 
(;; 
);; 
{<< 
if== 

(== 
!== 
sp== 
.== 
feedback== 
)== 
{>> 	
uploadImage?? 
(?? 
$str?? 
)?? 
;?? 
pv@@ 
.@@ 
backFunction@@ 
(@@ 
webCamTexture@@ )
)@@) *
;@@* +
}AA 	
elseBB 
pvBB 
.BB 
	BackToCamBB 
(BB 
webCamTextureBB '
)BB' (
;BB( )
}CC 
publicEE 

voidEE 
backEE 
(EE 
)EE 
{FF 
pvGG 

.GG
 
backFunctionGG 
(GG 
webCamTextureGG %
)GG% &
;GG& '
}HH 
publicKK 

voidKK 
TakePictKK 
(KK 
)KK 
{LL 
spMM 

.MM
 
	startTimeMM 
=MM 
DateTimeMM 
.MM  
NowMM  #
;MM# $
ifPP 

(PP 
!PP 
FilePP 
.PP 
ExistsPP 
(PP 
filePathPP !
)PP! "
)PP" #
{QQ 	
varRR 
writerRR 
=RR 
newRR 
BinaryWriterRR )
(RR) *
FileRR* .
.RR. /
OpenRR/ 3
(RR3 4
filePathRR4 <
,RR< =
FileModeRR> F
.RRF G
	CreateNewRRG P
)RRP Q
)RRQ R
;RRR S
usingSS 
(SS 
writerSS 
)SS 
{TT 
writerUU 
.UU 
WriteUU 
(UU 
$strUU (
+UU) *
DateTimeUU+ 3
.UU3 4
NowUU4 7
)UU7 8
;UU8 9
writerVV 
.VV 
WriteVV 
(VV 
$strVV &
+VV' (
DateTimeVV) 1
.VV1 2
UtcNowVV2 8
.VV8 9
MillisecondVV9 D
)VVD E
;VVE F
}WW 
}XX 	
elseYY 
{ZZ 	
var[[ 
writer[[ 
=[[ 
new[[ 
BinaryWriter[[ )
([[) *
File[[* .
.[[. /
Open[[/ 3
([[3 4
filePath[[4 <
,[[< =
FileMode[[> F
.[[F G
Open[[G K
)[[K L
)[[L M
;[[M N
using\\ 
(\\ 
writer\\ 
)\\ 
{]] 
writer^^ 
.^^ 
Write^^ 
(^^ 
$str^^ (
+^^) *
DateTime^^+ 3
.^^3 4
Now^^4 7
)^^7 8
;^^8 9
writer__ 
.__ 
Write__ 
(__ 
$str__ &
+__' (
DateTime__) 1
.__1 2
UtcNow__2 8
.__8 9
Millisecond__9 D
)__D E
;__E F
}`` 
}aa 	
Pictcc 
(cc 
webCamTexturecc 
,cc 

backgroundcc &
,cc& '
	seeingImgcc( 1
)cc1 2
;cc2 3
}dd 
publicff 

voidff 
Pictff 
(ff 
WebCamTextureff "
webCamTextureff# 0
,ff0 1
RawImageff2 :

backgroundff; E
,ffE F
RawImageffG O
	seeingImgffP Y
)ffY Z
{gg 
pjj 	
.jj	 

	hacerFotojj
 
(jj 
webCamTexturejj !
,jj! "

backgroundjj# -
,jj- .
	seeingImgjj/ 8
,jj8 9
pvjj: <
)jj< =
;jj= >
}kk 
publicmm 

voidmm 
uploadImagemm 
(mm 
stringmm "
user_predictmm# /
)mm/ 0
{nn 
poo 	
.oo	 

uploadImageoo
 
(oo 
user_predictoo "
)oo" #
;oo# $
}pp 
}ûû €)
s/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/CameraModel.cs
public 
class 
CameraModel 
: 
MonoBehaviour (
{ 
RawImage		 

background		 
;		 
Texture

 
defaultBackground

 
;

 
WebCamTexture 
webCamTexture 
;  
AspectRatioFitter 
fit 
; 
RawImage 
	seeingImg 
; 
float 	
ratio
 
, 
scaleY 
; 
int 
orient 
; 
bool 
frontFacing	 
; 
void 
Start	 
( 
) 
{ 
} 
void 
Update	 
( 
) 
{ 
} 
public.. 

void.. 
setParameters.. 
(.. 
RawImage.. &
bg..' )
,..) *
AspectRatioFitter..+ <
f..= >
,..> ?
RawImage..@ H
si..I K
,..K L
bool..M Q
front..R W
)..W X
{// 

background00 
=00 
bg00 
;00 
fit11 
=11 
f11 
;11 
	seeingImg22 
=22 
si22 
;22 
frontFacing33 
=33 
front33 
;33 
}44 
public66 

WebCamTexture66 

InitCamera66 #
(66# $
)66$ %
{77 
defaultBackground88 
=88 

background88 &
.88& '
texture88' .
;88. /
WebCamDevice99 
[99 
]99 
devices99 
=99  
WebCamTexture99! .
.99. /
devices99/ 6
;996 7
if;; 

(;; 
devices;; 
.;; 
Length;; 
==;; 
$num;; 
);;  
Debug<< 
.<< 
Log<< 
(<< 
$str<< !
)<<! "
;<<" #
for>> 
(>> 
int>> 
i>> 
=>> 
$num>> 
;>> 
i>> 
<>> 
devices>> #
.>># $
Length>>$ *
;>>* +
i>>, -
++>>- /
)>>/ 0
{?? 	
var@@ 
curr@@ 
=@@ 
devices@@ 
[@@ 
i@@  
]@@  !
;@@! "
ifBB 
(BB 
currBB 
.BB 
isFrontFacingBB "
==BB# %
frontFacingBB& 1
)BB1 2
{CC 
webCamTextureDD 
=DD 
newDD  #
WebCamTextureDD$ 1
(DD1 2
)DD2 3
;DD3 4
}EE 
}FF 	
ifHH 

(HH 
webCamTextureHH 
==HH 
nullHH !
)HH! "
DebugII 
.II 
LogII 
(II 
$strII !
)II! "
;II" #
ApplicationKK 
.KK $
RequestUserAuthorizationKK ,
(KK, -
UserAuthorizationKK- >
.KK> ?
WebCamKK? E
)KKE F
;KKF G
ApplicationLL 
.LL 
targetFrameRateLL #
=LL$ %
$numLL& )
;LL) *
webCamTextureMM 
.MM 
requestedFPSMM "
=MM# $
$numMM% (
;MM( )
webCamTextureOO 
.OO 
PlayOO 
(OO 
)OO 
;OO 

backgroundPP 
.PP 
texturePP 
=PP 
webCamTexturePP *
;PP* +
returnRR 
webCamTextureRR 
;RR 
}SS 
publicUU 

voidUU 
UpdateCameraUU 
(UU 
)UU 
{VV 
ratioWW 
=WW 
(WW 
floatWW 
)WW 
webCamTextureWW $
.WW$ %
widthWW% *
/WW+ ,
(WW- .
floatWW. 3
)WW3 4
webCamTextureWW4 A
.WWA B
heightWWB H
;WWH I
fitXX 
.XX 
aspectRatioXX 
=XX 
ratioXX 
;XX  
scaleYZZ 
=ZZ 
webCamTextureZZ 
.ZZ #
videoVerticallyMirroredZZ 6
?ZZ7 8
-ZZ9 :
$numZZ: <
:ZZ= >
$numZZ? A
;ZZA B

background[[ 
.[[ 
rectTransform[[  
.[[  !

localScale[[! +
=[[, -
new[[. 1
Vector3[[2 9
([[9 :
$num[[: <
,[[< =
scaleY[[> D
,[[D E
$num[[F H
)[[H I
;[[I J
orient]] 
=]] 
-]] 
webCamTexture]] 
.]]  
videoRotationAngle]]  2
;]]2 3

background^^ 
.^^ 
rectTransform^^  
.^^  !
localEulerAngles^^! 1
=^^2 3
new^^4 7
Vector3^^8 ?
(^^? @
$num^^@ A
,^^A B
$num^^C D
,^^D E
orient^^F L
)^^L M
;^^M N
}__ 
}`` Øp
q/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/CropScale.cs
public 
enum 
CropOptions 
{ 
CENTER 

,
 
BOTTOM_RIGHT 
, 
	TOP_RIGHT 
, 
BOTTOM_LEFT 
, 
TOP_LEFT 
, 
CUSTOM 

} 
public 
static 
class 
	CropScale 
{ 
public"" 

static"" 
	Texture2D"" 
ScaleTexture"" (
(""( )
	Texture2D"") 2
texture""3 :
,"": ;
int""< ?
width""@ E
,""E F
int""G J
height""K Q
)""Q R
{## 
Color$$ 
[$$ 
]$$ 
sourceColors$$ 
=$$ 
texture$$ &
.$$& '
	GetPixels$$' 0
($$0 1
)$$1 2
;$$2 3
Color%% 
[%% 
]%% 
	newColors%% 
=%% 
new%% 
Color%%  %
[%%% &
width%%& +
*%%, -
height%%. 4
]%%4 5
;%%5 6
float&& 
ratioX&& 
=&& 
$num&& 
/&& 
(&& 
(&& 
float&& #
)&&# $
width&&$ )
/&&* +
(&&, -
texture&&- 4
.&&4 5
width&&5 :
-&&; <
$num&&= >
)&&> ?
)&&? @
;&&@ A
float'' 
ratioY'' 
='' 
$num'' 
/'' 
('' 
('' 
float'' #
)''# $
height''$ *
/''+ ,
(''- .
texture''. 5
.''5 6
height''6 <
-''= >
$num''? @
)''@ A
)''A B
;''B C
for(( 
((( 
int(( 
i(( 
=(( 
$num(( 
;(( 
i(( 
<(( 
height(( "
;((" #
i(($ %
++((% '
)((' (
{)) 	
int** 
yFloor** 
=** 
(** 
int** 
)** 
Mathf** #
.**# $
Floor**$ )
(**) *
i*** +
***, -
ratioY**. 4
)**4 5
;**5 6
int++ 
colorY1++ 
=++ 
yFloor++  
*++! "
texture++# *
.++* +
width+++ 0
;++0 1
int,, 
colorY2,, 
=,, 
(,, 
yFloor,, !
+,," #
$num,,$ %
),,% &
*,,' (
texture,,) 0
.,,0 1
width,,1 6
;,,6 7
int-- 
offset-- 
=-- 
i-- 
*-- 
width-- "
;--" #
for.. 
(.. 
int.. 
j.. 
=.. 
$num.. 
;.. 
j.. 
<.. 
width..  %
;..% &
j..' (
++..( *
)..* +
{// 
int00 
xFloor00 
=00 
(00 
int00 !
)00! "
Mathf00" '
.00' (
Floor00( -
(00- .
j00. /
*000 1
ratioX002 8
)008 9
;009 :
float11 
xLerp11 
=11 
j11 
*11  !
ratioX11" (
-11) *
xFloor11+ 1
;111 2
	newColors22 
[22 
offset22  
+22! "
j22# $
]22$ %
=22& '
ColorLerpUnclamped22( :
(22: ;
ColorLerpUnclamped22; M
(22M N
sourceColors22N Z
[22Z [
colorY122[ b
+22c d
xFloor22e k
]22k l
,22l m
sourceColors22n z
[22z {
colorY1	22{ Ç
+
22É Ñ
xFloor
22Ö ã
+
22å ç
$num
22é è
]
22è ê
,
22ê ë
xLerp
22í ó
)
22ó ò
,
22ò ô 
ColorLerpUnclamped
22ö ¨
(
22¨ ≠
sourceColors
22≠ π
[
22π ∫
colorY2
22∫ ¡
+
22¬ √
xFloor
22ƒ  
]
22  À
,
22À Ã
sourceColors
22Õ Ÿ
[
22Ÿ ⁄
colorY2
22⁄ ·
+
22‚ „
xFloor
22‰ Í
+
22Î Ï
$num
22Ì Ó
]
22Ó Ô
,
22Ô 
xLerp
22Ò ˆ
)
22ˆ ˜
,
22˜ ¯
i
22˘ ˙
*
22˚ ¸
ratioY
22˝ É
-
22Ñ Ö
yFloor
22Ü å
)
22å ç
;
22ç é
}33 
}44 	
texture55 
.55 
Resize55 
(55 
width55 
,55 
height55 $
)55$ %
;55% &
texture66 
.66 
	SetPixels66 
(66 
	newColors66 #
)66# $
;66$ %
texture77 
.77 
Apply77 
(77 
)77 
;77 
sourceColors88 
=88 
null88 
;88 
	newColors99 
=99 
null99 
;99 
return:: 
texture:: 
;:: 
};; 
static@@ 

Color@@ 
ColorLerpUnclamped@@ #
(@@# $
Color@@$ )
color1@@* 0
,@@0 1
Color@@2 7
color2@@8 >
,@@> ?
float@@@ E
value@@F K
)@@K L
{AA 
returnBB 
newBB 
ColorBB 
(BB 
color1BB 
.BB  
rBB  !
+BB" #
(BB$ %
color2BB% +
.BB+ ,
rBB, -
-BB. /
color1BB0 6
.BB6 7
rBB7 8
)BB8 9
*BB: ;
valueBB< A
,BBA B
color1BBC I
.BBI J
gBBJ K
+BBL M
(BBN O
color2BBO U
.BBU V
gBBV W
-BBX Y
color1BBZ `
.BB` a
gBBa b
)BBb c
*BBd e
valueBBf k
,BBk l
color1BBm s
.BBs t
bBBt u
+BBv w
(BBx y
color2BBy 
.	BB Ä
b
BBÄ Å
-
BBÇ É
color1
BBÑ ä
.
BBä ã
b
BBã å
)
BBå ç
*
BBé è
value
BBê ï
,
BBï ñ
color1
BBó ù
.
BBù û
a
BBû ü
+
BB† °
(
BB¢ £
color2
BB£ ©
.
BB© ™
a
BB™ ´
-
BB¨ ≠
color1
BBÆ ¥
.
BB¥ µ
a
BBµ ∂
)
BB∂ ∑
*
BB∏ π
value
BB∫ ø
)
BBø ¿
;
BB¿ ¡
}CC 
publicNN 

staticNN 
	Texture2DNN 
CropTextureNN '
(NN' (
	Texture2DNN( 1
textureNN2 9
,NN9 :
Vector2NN; B
cropNNC G
,NNG H
CropOptionsNNI T
optionsNNU \
=NN] ^
CropOptionsNN_ j
.NNj k
CENTERNNk q
,NNq r
intNNs v
xNNw x
=NNy z
$numNN{ |
,NN| }
int	NN~ Å
y
NNÇ É
=
NNÑ Ö
$num
NNÜ á
)
NNá à
{OO 
ifPP 

(PP 
cropPP 
.PP 
xPP 
<PP 
$numPP 
||PP 
cropPP 
.PP  
yPP  !
<PP" #
$numPP$ &
)PP& '
{QQ 	
returnRR 
textureRR 
;RR 
}SS 	
RectTT 
sizesTT 
=TT 
newTT 
RectTT 
(TT 
)TT 
;TT  
	Texture2DUU 
resultUU 
=UU 
newUU 
	Texture2DUU (
(UU( )
(UU) *
intUU* -
)UU- .
cropUU. 2
.UU2 3
xUU3 4
,UU4 5
(UU6 7
intUU7 :
)UU: ;
cropUU; ?
.UU? @
yUU@ A
)UUA B
;UUB C
ifVV 

(VV 
cropVV 
.VV 
xVV 
!=VV 
$numVV 
&&VV 
cropVV  
.VV  !
yVV! "
!=VV# %
$numVV& (
)VV( )
{WW 	
sizesXX 
.XX 
xXX 
=XX 
$numXX 
;XX 
sizesYY 
.YY 
yYY 
=YY 
$numYY 
;YY 
sizesZZ 
.ZZ 
widthZZ 
=ZZ 
cropZZ 
.ZZ 
xZZ  
;ZZ  !
sizes[[ 
.[[ 
height[[ 
=[[ 
crop[[ 
.[[  
y[[  !
;[[! "
switch\\ 
(\\ 
options\\ 
)\\ 
{]] 
case^^ 
CropOptions^^  
.^^  !
CENTER^^! '
:^^' (
sizes__ 
.__ 
x__ 
=__ 
(__ 
texture__ &
.__& '
width__' ,
-__- .
crop__/ 3
.__3 4
x__4 5
)__5 6
/__7 8
$num__9 ;
;__; <
sizes`` 
.`` 
y`` 
=`` 
(`` 
texture`` &
.``& '
height``' -
-``. /
crop``0 4
.``4 5
y``5 6
)``6 7
/``8 9
$num``: <
;``< =
breakaa 
;aa 
casebb 
CropOptionsbb  
.bb  !
BOTTOM_RIGHTbb! -
:bb- .
sizescc 
.cc 
xcc 
=cc 
texturecc %
.cc% &
widthcc& +
-cc, -
cropcc. 2
.cc2 3
xcc3 4
;cc4 5
breakdd 
;dd 
caseee 
CropOptionsee  
.ee  !
BOTTOM_LEFTee! ,
:ee, -
breakff 
;ff 
casegg 
CropOptionsgg  
.gg  !
TOP_LEFTgg! )
:gg) *
sizeshh 
.hh 
yhh 
=hh 
texturehh %
.hh% &
heighthh& ,
-hh- .
crophh/ 3
.hh3 4
yhh4 5
;hh5 6
breakii 
;ii 
casejj 
CropOptionsjj  
.jj  !
	TOP_RIGHTjj! *
:jj* +
sizeskk 
.kk 
xkk 
=kk 
texturekk %
.kk% &
widthkk& +
-kk, -
cropkk. 2
.kk2 3
xkk3 4
;kk4 5
sizesll 
.ll 
yll 
=ll 
texturell %
.ll% &
heightll& ,
-ll- .
cropll/ 3
.ll3 4
yll4 5
;ll5 6
breakmm 
;mm 
casenn 
CropOptionsnn  
.nn  !
CUSTOMnn! '
:nn' (
floatoo 
widthoo 
=oo  !
textureoo" )
.oo) *
widthoo* /
-oo0 1
cropoo2 6
.oo6 7
xoo7 8
-oo9 :
xoo; <
;oo< =
floatpp 
heightpp  
=pp! "
texturepp# *
.pp* +
heightpp+ 1
-pp2 3
croppp4 8
.pp8 9
ypp9 :
-pp; <
ypp= >
;pp> ?
sizesqq 
.qq 
xqq 
=qq 
(qq 
widthqq $
>qq% &
textureqq' .
.qq. /
widthqq/ 4
)qq4 5
?qq6 7
$numqq8 :
:qq; <
widthqq= B
;qqB C
sizesrr 
.rr 
yrr 
=rr 
(rr 
heightrr %
>rr& '
texturerr( /
.rr/ 0
heightrr0 6
)rr6 7
?rr8 9
$numrr: <
:rr= >
heightrr? E
;rrE F
breakss 
;ss 
}tt 
ifuu 
(uu 
(uu 
textureuu 
.uu 
widthuu 
<uu  
sizesuu! &
.uu& '
xuu' (
+uu) *
cropuu+ /
.uu/ 0
xuu0 1
)uu1 2
||uu3 5
(uu6 7
textureuu7 >
.uu> ?
heightuu? E
<uuF G
sizesuuH M
.uuM N
yuuN O
+uuP Q
cropuuR V
.uuV W
yuuW X
)uuX Y
||uuZ \
(uu] ^
sizesuu^ c
.uuc d
xuud e
>uuf g
textureuuh o
.uuo p
widthuup u
)uuu v
||uuw y
(uuz {
sizes	uu{ Ä
.
uuÄ Å
y
uuÅ Ç
>
uuÉ Ñ
texture
uuÖ å
.
uuå ç
height
uuç ì
)
uuì î
||
uuï ó
(
uuò ô
sizes
uuô û
.
uuû ü
x
uuü †
<
uu° ¢
$num
uu£ §
)
uu§ •
||
uu¶ ®
(
uu© ™
sizes
uu™ Ø
.
uuØ ∞
y
uu∞ ±
<
uu≤ ≥
$num
uu¥ µ
)
uuµ ∂
||
uu∑ π
(
uu∫ ª
crop
uuª ø
.
uuø ¿
x
uu¿ ¡
<
uu¬ √
$num
uuƒ ≈
)
uu≈ ∆
||
uu« …
(
uu  À
crop
uuÀ œ
.
uuœ –
y
uu– —
<
uu“ ”
$num
uu‘ ’
)
uu’ ÷
)
uu÷ ◊
{vv 
returnww 
textureww 
;ww 
}xx 
resultyy 
.yy 
	SetPixelsyy 
(yy 
textureyy $
.yy$ %
	GetPixelsyy% .
(yy. /
Mathfyy/ 4
.yy4 5

FloorToIntyy5 ?
(yy? @
sizesyy@ E
.yyE F
xyyF G
)yyG H
,yyH I
MathfyyJ O
.yyO P

FloorToIntyyP Z
(yyZ [
sizesyy[ `
.yy` a
yyya b
)yyb c
,yyc d
Mathfyye j
.yyj k

FloorToIntyyk u
(yyu v
sizesyyv {
.yy{ |
width	yy| Å
)
yyÅ Ç
,
yyÇ É
Mathf
yyÑ â
.
yyâ ä

FloorToInt
yyä î
(
yyî ï
sizes
yyï ö
.
yyö õ
height
yyõ °
)
yy° ¢
)
yy¢ £
)
yy£ §
;
yy§ •
resultzz 
.zz 
Applyzz 
(zz 
)zz 
;zz 
}{{ 	
return|| 
result|| 
;|| 
}}} 
} §O
o/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/Picture.cs
public		 
class		 
Picture		 
:		 
MonoBehaviour		 $
{

 
public 

int 
idx 
; 
public 

string 
prob 
; 
public 

Image 
picture 
; 
public 

UpdateImage 
ui 
; 
public 

PictureController 
pc 
;  
public 

Tuple 
< 
double 
[ 
] 
, 
double !
[! "
]" #
># $
result% +
;+ ,
	Texture2D 

PhotoTaken 
;  
SingletonPreferences 
sp 
; 
public 


Dictionary 
< 
int 
, 
string !
>! "
idx_to_labels# 0
=1 2
new3 6

Dictionary7 A
<A B
intB E
,E F
stringG M
>M N
(N O
)O P
;P Q
public 

int 

prediction 
; 
void 
Start	 
( 
) 
{ 
sp   

=    
SingletonPreferences   !
.  ! "
Instance  " *
;  * +
idx_to_labels!! 
=!! 

ReadLabels!! "
(!!" #
)!!# $
;!!$ %
}"" 
void%% 
Update%%	 
(%% 
)%% 
{&& 
}(( 
public++ 

int++ 
getIdx++ 
(++ 
)++ 
{,, 
return-- 
idx-- 
;-- 
}.. 
public11 

void11 
setIdx11 
(11 
int11 
i11 
)11 
{22 
idx33 
=33 
i33 
;33 
}44 
public77 

string77 
getProb77 
(77 
)77 
{88 
return99 
prob99 
;99 
}:: 
public== 

void== 
setProb== 
(== 
string== 
p==  
)==  !
{>> 
prob?? 
=?? 
p?? 
;?? 
}@@ 
publicCC 

ImageCC 

getPictureCC 
(CC 
)CC 
{DD 
returnEE 
pictureEE 
;EE 
}FF 
publicII 

voidII 

setPictureII 
(II 
ImageII  
pictII! %
)II% &
{JJ 
pictureKK 
=KK 
pictKK 
;KK 
}LL 
publicUU 

voidUU 
	hacerFotoUU 
(UU 
WebCamTextureUU '
webCamTextureUU( 5
,UU5 6
RawImageUU7 ?

backgroundUU@ J
,UUJ K
RawImageUUL T
	seeingImgUUU ^
,UU^ _
PrincipalViewUU` m
pvUUn p
)UUp q
{VV 
StartCoroutineWW 
(WW 
TakePictureWW "
(WW" #
webCamTextureWW# 0
,WW0 1

backgroundWW2 <
,WW< =
	seeingImgWW> G
,WWG H
pvWWI K
)WWK L
)WWL M
;WWM N
}XX 
IEnumeratorZZ 
TakePictureZZ 
(ZZ 
WebCamTextureZZ )
webCamTextureZZ* 7
,ZZ7 8
RawImageZZ9 A

backgroundZZB L
,ZZL M
RawImageZZN V
	seeingImgZZW `
,ZZ` a
PrincipalViewZZb o
pvZZp r
)ZZr s
{[[ 

PhotoTaken\\ 
=\\ 
new\\ 
	Texture2D\\ "
(\\" #
webCamTexture\\# 0
.\\0 1
width\\1 6
,\\6 7
webCamTexture\\8 E
.\\E F
height\\F L
)\\L M
;\\M N

PhotoTaken^^ 
.^^ 
	SetPixels^^ 
(^^ 
webCamTexture^^ *
.^^* +
	GetPixels^^+ 4
(^^4 5
)^^5 6
)^^6 7
;^^7 8

PhotoTaken__ 
.__ 
Apply__ 
(__ 
)__ 
;__ 

backgroundcc 
.cc 
texturecc 
=cc 

PhotoTakencc '
;cc' (
resultdd 
=dd 
pcdd 
.dd 
	FeedModeldd 
(dd 

PhotoTakendd (
,dd( )
	seeingImgdd* 3
)dd3 4
;dd4 5
pvgg 

.gg
 
SetPredictionTextsgg 
(gg 
resultgg $
.gg$ %
Item1gg% *
,gg* +
resultgg, 2
.gg2 3
Item2gg3 8
,gg8 9
idx_to_labelsgg: G
)ggG H
;ggH I

predictionii 
=ii 
(ii 
intii 
)ii 
resultii  
.ii  !
Item1ii! &
[ii& '
$numii' (
]ii( )
;ii) *
yieldkk 
returnkk 
newkk 
WaitForEndOfFramekk *
(kk* +
)kk+ ,
;kk, -
}ll 
publicnn 

voidnn 
uploadImagenn 
(nn 
stringnn "
user_predictionnn# 2
)nn2 3
{oo 
ifqq 

(qq 
user_predictionqq 
!=qq 
$strqq /
)qq/ 0
{rr 	
user_predictionss 
=ss 
GetKeyFromValuess -
(ss- .
user_predictionss. =
)ss= >
.ss> ?
ToStringss? G
(ssG H
)ssH I
;ssI J
}tt 	
uiuu 

.uu
 
StartUploaduu 
(uu 

PhotoTakenuu !
,uu! "

predictionuu# -
.uu- .
ToStringuu. 6
(uu6 7
)uu7 8
,uu8 9
user_predictionuu: I
,uuI J
spuuK M
.uuM N
feedbackuuN V
)uuV W
;uuW X
}vv 
publicxx 

intxx 
GetKeyFromValuexx 
(xx 
stringxx %
user_predictionxx& 5
)xx5 6
{yy 
foreachzz 
(zz 
intzz 
keyVarzz 
inzz 
idx_to_labelszz ,
.zz, -
Keyszz- 1
)zz1 2
{{{ 	
if|| 
(|| 
idx_to_labels|| 
[|| 
keyVar|| $
]||$ %
==||& (
user_prediction||) 8
)||8 9
{}} 
return~~ 
keyVar~~ 
;~~ 
} 
}
ÄÄ 	
return
ÅÅ 
-
ÅÅ 
$num
ÅÅ 
;
ÅÅ 
}
ÇÇ 
public
ÜÜ 


Dictionary
ÜÜ 
<
ÜÜ 
int
ÜÜ 
,
ÜÜ 
string
ÜÜ !
>
ÜÜ! "

ReadLabels
ÜÜ# -
(
ÜÜ- .
)
ÜÜ. /
{
áá 

Dictionary
ââ 
<
ââ 
int
ââ 
,
ââ 
string
ââ 
>
ââ 
IDXS
ââ  $
=
ââ% &
new
ââ' *

Dictionary
ââ+ 5
<
ââ5 6
int
ââ6 9
,
ââ9 :
string
ââ; A
>
ââA B
(
ââB C
)
ââC D
;
ââD E
	TextAsset
ãã 
f
ãã 
=
ãã 
(
ãã 
	TextAsset
ãã  
)
ãã  !
	Resources
ãã! *
.
ãã* +
Load
ãã+ /
(
ãã/ 0
$str
ãã0 E
,
ããE F
typeof
ããG M
(
ããM N
	TextAsset
ããN W
)
ããW X
)
ããX Y
;
ããY Z
if
éé 

(
éé 
f
éé 
!=
éé 
null
éé 
)
éé 
{
èè 	
string
êê 
text
êê 
=
êê 
f
êê 
.
êê 
text
êê  
;
êê  !
string
ëë 
[
ëë 
]
ëë 
lines
ëë 
=
ëë 
text
ëë !
.
ëë! "
Split
ëë" '
(
ëë' (
System
ëë( .
.
ëë. /
Environment
ëë/ :
.
ëë: ;
NewLine
ëë; B
.
ëëB C
ToCharArray
ëëC N
(
ëëN O
)
ëëO P
)
ëëP Q
;
ëëQ R
foreach
ìì 
(
ìì 
string
ìì 
line
ìì  
in
ìì! #
lines
ìì$ )
)
ìì) *
{
îî 
string
ïï 
[
ïï 
]
ïï 
line_to_words
ïï &
=
ïï' (
line
ïï) -
.
ïï- .
Split
ïï. 3
(
ïï3 4
$char
ïï4 7
)
ïï7 8
;
ïï8 9
int
ññ 
index
ññ 
=
ññ 
int
ññ 
.
ññ  
Parse
ññ  %
(
ññ% &
line_to_words
ññ& 3
[
ññ3 4
line_to_words
ññ4 A
.
ññA B
Length
ññB H
-
ññI J
$num
ññK L
]
ññL M
)
ññM N
;
ññN O
string
óó 
fullname
óó 
=
óó  !
$str
óó" $
;
óó$ %
for
òò 
(
òò 
int
òò 
i
òò 
=
òò 
$num
òò 
;
òò 
i
òò  !
<
òò" #
line_to_words
òò$ 1
.
òò1 2
Length
òò2 8
-
òò9 :
$num
òò; <
;
òò< =
i
òò> ?
++
òò? A
)
òòA B
{
ôô 
fullname
öö 
+=
öö 
line_to_words
öö  -
[
öö- .
i
öö. /
]
öö/ 0
+
öö1 2
$str
öö3 6
;
öö6 7
}
õõ 
IDXS
ùù 
[
ùù 
index
ùù 
]
ùù 
=
ùù 
fullname
ùù &
;
ùù& '
}
üü 
}
†† 	
return
°° 
IDXS
°° 
;
°° 
}
££ 
}§§ §ñ
y/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/PictureController.cs
public 
class 
PictureController 
:  
MonoBehaviour! .
{  
SingletonPreferences 
sp 
; 
void 
Start	 
( 
) 
{ 
sp 

=  
SingletonPreferences !
.! "
Instance" *
;* +
} 
void 
Update	 
( 
) 
{ 
} 
public"" 

Tuple"" 
<"" 
double"" 
["" 
]"" 
,"" 
double"" !
[""! "
]""" #
>""# $
	FeedModel""% .
("". /
	Texture2D""/ 8
t""9 :
,"": ;
RawImage""< D
	seeingImg""E N
)""N O
{## 
var%% 
img_t_%% 
=%% 
ImageToTensor%% "
(%%" #
t%%# $
,%%$ %
	seeingImg%%& /
)%%/ 0
;%%0 1
sp'' 

.''
 
worker'' 
.'' 
Execute'' 
('' 
img_t_''  
)''  !
;''! "
var)) 
O)) 
=)) 
sp)) 
.)) 
worker)) 
.)) 

PeekOutput)) $
())$ %
)))% &
;))& '
img_t_++ 
.++ 
Dispose++ 
(++ 
)++ 
;++ 
double.. 
[.. 
].. 
outputs_probs.. 
=..  
new..! $
double..% +
[..+ ,
O.., -
...- .
length... 4
]..4 5
;..5 6
for00 
(00 
int00 
i00 
=00 
$num00 
;00 
i00 
<00 
O00 
.00 
length00 $
;00$ %
i00& '
++00' )
)00) *
{11 	
outputs_probs22 
[22 
i22 
]22 
=22 
O22  
[22  !
$num22! "
,22" #
$num22$ %
,22% &
$num22' (
,22( )
i22* +
]22+ ,
;22, -
}33 	
double55 
[55 
]55 
sm_probs55 
=55 
Softmax55 #
(55# $
outputs_probs55$ 1
)551 2
;552 3

Dictionary77 
<77 
double77 
,77 
int77 
>77 

pred_to_id77  *
=77+ ,
new77- 0

Dictionary771 ;
<77; <
double77< B
,77B C
int77D G
>77G H
(77H I
)77I J
;77J K
for99 
(99 
int99 
i99 
=99 
$num99 
;99 
i99 
<99 
outputs_probs99 )
.99) *
Length99* 0
;990 1
i992 3
++993 5
)995 6
{:: 	

pred_to_id;; 
[;; 
sm_probs;; 
[;;  
i;;  !
];;! "
];;" #
=;;$ %
i;;& '
;;;' (
}<< 	
double>> 
[>> 
]>> 

best_probs>> 
=>> 
	FindBestK>> '
(>>' (
sm_probs>>( 0
,>>0 1
$num>>2 3
)>>3 4
;>>4 5
double?? 
[?? 
]?? 
	best_idxs?? 
=?? 
new??  
double??! '
[??' (
$num??( )
]??) *
;??* +
for@@ 
(@@ 
int@@ 
i@@ 
=@@ 
$num@@ 
;@@ 
i@@ 
<@@ 
$num@@ 
;@@ 
i@@  
++@@  "
)@@" #
{AA 	
	best_idxsBB 
[BB 
iBB 
]BB 
=BB 

pred_to_idBB %
[BB% &

best_probsBB& 0
[BB0 1
iBB1 2
]BB2 3
]BB3 4
;BB4 5
}CC 	
returnEE 
TupleEE 
.EE 
CreateEE 
(EE 
	best_idxsEE %
,EE% &

best_probsEE' 1
)EE1 2
;EE2 3
}FF 
TensorII 

ImageToTensorII 
(II 
	Texture2DII "
tII# $
,II$ %
RawImageII& .
	seeingImgII/ 8
)II8 9
{JJ 
varKK 
channelCountKK 
=KK 
$numKK 
;KK 
	Texture2DMM 
cropMM 
=MM 
	CropScaleMM "
.MM" #
CropTextureMM# .
(MM. /
tMM/ 0
,MM0 1
newMM2 5
Vector2MM6 =
(MM= >
$numMM> A
,MMA B
$numMMC F
)MMF G
,MMG H
CropOptionsMMI T
.MMT U
CENTERMMU [
,MM[ \
$numMM] ^
,MM^ _
$numMM` a
)MMa b
;MMb c
	Texture2DPP 
resized_imgPP 
=PP 
ResizePP  &
(PP& '
cropPP' +
,PP+ ,
$numPP- 0
,PP0 1
$numPP2 5
)PP5 6
;PP6 7
	seeingImgSS 
.SS 
textureSS 
=SS 
resized_imgSS '
;SS' (
TensorYY 

img_tensorYY 
=YY 
newYY 
TensorYY  &
(YY& '
resized_imgYY' 2
,YY2 3
channelCountYY4 @
)YY@ A
;YYA B
var^^ 

std_tensor^^ 
=^^ 
StandardizeTensor^^ *
(^^* +

img_tensor^^+ 5
,^^5 6
new^^7 :
double^^; A
[^^A B
]^^B C
{^^D E
$num^^F L
,^^L M
$num^^N T
,^^T U
$num^^V \
}^^] ^
,^^^ _
new^^` c
double^^d j
[^^j k
]^^k l
{^^m n
$num^^o u
,^^u v
$num^^w }
,^^} ~
$num	^^ Ö
}
^^Ü á
)
^^á à
;
^^à â
byte`` 
[`` 
]`` 
bytes`` 
=`` 
resized_img`` "
.``" #
EncodeToJPG``# .
(``. /
)``/ 0
;``0 1
ifbb 

(bb 
Applicationbb 
.bb 
platformbb  
!=bb! #
RuntimePlatformbb$ 3
.bb3 4
Androidbb4 ;
)bb; <
{cc 	
stringdd 
filenamedd 
=dd 
Applicationdd )
.dd) *
dataPathdd* 2
+dd3 4
Systemdd5 ;
.dd; <
DateTimedd< D
.ddD E
NowddE H
.ddH I
ToStringddI Q
(ddQ R
$strddR g
)ddg h
+ddi j
$strddk q
;ddq r
}ff 	
elsegg 
{hh 	
ifii 
(ii 
!ii 
PlayerPrefsii 
.ii 
HasKeyii #
(ii# $
$strii$ 0
)ii0 1
)ii1 2
{jj 
PlayerPrefskk 
.kk 
SetIntkk "
(kk" #
$strkk# /
,kk/ 0
$numkk1 2
)kk2 3
;kk3 4
}ll 
elsemm 
{nn 
PlayerPrefsoo 
.oo 
SetIntoo "
(oo" #
$stroo# /
,oo/ 0
PlayerPrefsoo1 <
.oo< =
GetIntoo= C
(ooC D
$strooD P
)ooP Q
+ooR S
$numooT U
)ooU V
;ooV W
}pp 
stringrr 
filenamerr 
=rr 
Applicationrr )
.rr) *
persistentDataPathrr* <
+rr= >
PlayerPrefsrr? J
.rrJ K
GetIntrrK Q
(rrQ R
$strrrR ^
)rr^ _
.rr_ `
ToStringrr` h
(rrh i
)rri j
+rrk l
$strrrm s
;rrs t
Filess 
.ss 
WriteAllBytesss 
(ss 
filenamess '
,ss' (
bytesss) .
)ss. /
;ss/ 0
}tt 	

img_tensorww 
.ww 
Disposeww 
(ww 
)ww 
;ww 
returnyy 

std_tensoryy 
;yy 
}zz 
double}} 

[}}
 
]}} 
	FindBestK}} 
(}} 
double}} 
[}} 
]}} 
output}}  &
,}}& '
int}}( +
k}}, -
)}}- .
{~~ 
Array 
. 
Sort 
( 
output 
) 
; 
Array
ÄÄ 
.
ÄÄ 
Reverse
ÄÄ 
(
ÄÄ 
output
ÄÄ 
)
ÄÄ 
;
ÄÄ 
double
ÅÅ 
[
ÅÅ 
]
ÅÅ 
best
ÅÅ 
=
ÅÅ 
new
ÅÅ 
double
ÅÅ "
[
ÅÅ" #
k
ÅÅ# $
]
ÅÅ$ %
;
ÅÅ% &
for
ÉÉ 
(
ÉÉ 
int
ÉÉ 
i
ÉÉ 
=
ÉÉ 
$num
ÉÉ 
;
ÉÉ 
i
ÉÉ 
<
ÉÉ 
k
ÉÉ 
;
ÉÉ 
i
ÉÉ  
++
ÉÉ  "
)
ÉÉ" #
{
ÑÑ 	
best
ÖÖ 
[
ÖÖ 
i
ÖÖ 
]
ÖÖ 
=
ÖÖ 
output
ÖÖ 
[
ÖÖ 
i
ÖÖ 
]
ÖÖ 
;
ÖÖ  
}
ÜÜ 	
return
àà 
best
àà 
;
àà 
}
ââ 
double
ãã 

[
ãã
 
]
ãã 
Softmax
ãã 
(
ãã 
double
ãã 
[
ãã 
]
ãã 
oSums
ãã #
)
ãã# $
{
çç 
double
èè 
max
èè 
=
èè 
oSums
èè 
[
èè 
$num
èè 
]
èè 
;
èè 
for
ëë 
(
ëë 
int
ëë 
i
ëë 
=
ëë 
$num
ëë 
;
ëë 
i
ëë 
<
ëë 
oSums
ëë !
.
ëë! "
Length
ëë" (
;
ëë( )
++
ëë* ,
i
ëë, -
)
ëë- .
if
ìì 
(
ìì 
oSums
ìì 
[
ìì 
i
ìì 
]
ìì 
>
ìì 
max
ìì 
)
ìì 
max
ìì  #
=
ìì$ %
oSums
ìì& +
[
ìì+ ,
i
ìì, -
]
ìì- .
;
ìì. /
double
óó 
scale
óó 
=
óó 
$num
óó 
;
óó 
for
ôô 
(
ôô 
int
ôô 
i
ôô 
=
ôô 
$num
ôô 
;
ôô 
i
ôô 
<
ôô 
oSums
ôô !
.
ôô! "
Length
ôô" (
;
ôô( )
++
ôô* ,
i
ôô, -
)
ôô- .
scale
õõ 
+=
õõ 
Math
õõ 
.
õõ 
Exp
õõ 
(
õõ 
oSums
õõ #
[
õõ# $
i
õõ$ %
]
õõ% &
-
õõ' (
max
õõ) ,
)
õõ, -
;
õõ- .
double
ùù 
[
ùù 
]
ùù 
result
ùù 
=
ùù 
new
ùù 
double
ùù $
[
ùù$ %
oSums
ùù% *
.
ùù* +
Length
ùù+ 1
]
ùù1 2
;
ùù2 3
for
üü 
(
üü 
int
üü 
i
üü 
=
üü 
$num
üü 
;
üü 
i
üü 
<
üü 
oSums
üü !
.
üü! "
Length
üü" (
;
üü( )
++
üü* ,
i
üü, -
)
üü- .
result
°° 
[
°° 
i
°° 
]
°° 
=
°° 
Math
°° 
.
°° 
Exp
°°  
(
°°  !
oSums
°°! &
[
°°& '
i
°°' (
]
°°( )
-
°°* +
max
°°, /
)
°°/ 0
/
°°1 2
scale
°°3 8
;
°°8 9
return
££ 
result
££ 
;
££ 
}
•• 
Tensor
ßß 

StandardizeTensor
ßß 
(
ßß 
Tensor
ßß #
img
ßß$ '
,
ßß' (
double
ßß) /
[
ßß/ 0
]
ßß0 1
mean
ßß2 6
,
ßß6 7
double
ßß8 >
[
ßß> ?
]
ßß? @
std
ßßA D
)
ßßD E
{
®® 
Tensor
©© 
img_copy
©© 
=
©© 
new
©© 
Tensor
©© $
(
©©$ %
$num
©©% &
,
©©& '
$num
©©( +
,
©©+ ,
$num
©©- 0
,
©©0 1
$num
©©2 3
)
©©3 4
;
©©4 5
for
™™ 
(
™™ 
int
™™ 
c
™™ 
=
™™ 
$num
™™ 
;
™™ 
c
™™ 
<
™™ 
$num
™™ 
;
™™ 
c
™™  
++
™™  "
)
™™" #
{
´´ 	
int
¨¨ 
channel
¨¨ 
=
¨¨ 
c
¨¨ 
;
¨¨ 
for
≠≠ 
(
≠≠ 
int
≠≠ 
i
≠≠ 
=
≠≠ 
$num
≠≠ 
;
≠≠ 
i
≠≠ 
<
≠≠ 
img
≠≠  #
.
≠≠# $
width
≠≠$ )
;
≠≠) *
i
≠≠+ ,
++
≠≠, .
)
≠≠. /
{
ÆÆ 
for
ØØ 
(
ØØ 
int
ØØ 
j
ØØ 
=
ØØ 
$num
ØØ 
;
ØØ 
j
ØØ  !
<
ØØ" #
img
ØØ$ '
.
ØØ' (
height
ØØ( .
;
ØØ. /
j
ØØ0 1
++
ØØ1 3
)
ØØ3 4
{
∞∞ 
img_copy
±± 
[
±± 
$num
±± 
,
±± 
i
±±  !
,
±±! "
j
±±# $
,
±±$ %
channel
±±& -
]
±±- .
=
±±/ 0
(
±±1 2
img
±±2 5
[
±±5 6
$num
±±6 7
,
±±7 8
i
±±9 :
,
±±: ;
j
±±< =
,
±±= >
channel
±±? F
]
±±F G
-
±±H I
(
±±J K
float
±±K P
)
±±P Q
mean
±±Q U
[
±±U V
c
±±V W
]
±±W X
)
±±X Y
/
±±Z [
(
±±\ ]
float
±±] b
)
±±b c
std
±±c f
[
±±f g
c
±±g h
]
±±h i
;
±±i j
}
≥≥ 
}
¥¥ 
}
µµ 	
return
∏∏ 
img_copy
∏∏ 
;
∏∏ 
}
ππ 
	Texture2D
ªª 
Resize
ªª 
(
ªª 
	Texture2D
ªª 
	texture2D
ªª (
,
ªª( )
int
ªª* -
targetX
ªª. 5
,
ªª5 6
int
ªª7 :
targetY
ªª; B
)
ªªB C
{
ºº 
RenderTexture
ææ 
rt
ææ 
=
ææ 
new
ææ 
RenderTexture
ææ ,
(
ææ, -
targetX
ææ- 4
,
ææ4 5
targetY
ææ6 =
,
ææ= >
$num
ææ? @
)
ææ@ A
;
ææA B
RenderTexture
øø 
.
øø 
active
øø 
=
øø 
rt
øø !
;
øø! "
Graphics
¿¿ 
.
¿¿ 
Blit
¿¿ 
(
¿¿ 
	texture2D
¿¿ 
,
¿¿  
rt
¿¿! #
)
¿¿# $
;
¿¿$ %
	Texture2D
¡¡ 
result
¡¡ 
=
¡¡ 
new
¡¡ 
	Texture2D
¡¡ (
(
¡¡( )
targetX
¡¡) 0
,
¡¡0 1
targetY
¡¡2 9
)
¡¡9 :
;
¡¡: ;
result
¬¬ 
.
¬¬ 

ReadPixels
¬¬ 
(
¬¬ 
new
¬¬ 
Rect
¬¬ "
(
¬¬" #
$num
¬¬# $
,
¬¬$ %
$num
¬¬& '
,
¬¬' (
targetX
¬¬) 0
,
¬¬0 1
targetY
¬¬2 9
)
¬¬9 :
,
¬¬: ;
$num
¬¬< =
,
¬¬= >
$num
¬¬? @
)
¬¬@ A
;
¬¬A B
result
√√ 
.
√√ 
Apply
√√ 
(
√√ 
)
√√ 
;
√√ 
	Texture2D
≈≈ 

rot_result
≈≈ 
=
≈≈ 
	rotate270
≈≈ (
(
≈≈( )
result
≈≈) /
)
≈≈/ 0
;
≈≈0 1
return
»» 

rot_result
»» 
;
»» 
}
…… 
public
ÀÀ 

	Texture2D
ÀÀ 
	rotate270
ÀÀ 
(
ÀÀ 
	Texture2D
ÀÀ (
orig
ÀÀ) -
)
ÀÀ- .
{
ÃÃ 
Color32
ÕÕ 
[
ÕÕ 
]
ÕÕ 
origpix
ÕÕ 
=
ÕÕ 
orig
ÕÕ  
.
ÕÕ  !
GetPixels32
ÕÕ! ,
(
ÕÕ, -
$num
ÕÕ- .
)
ÕÕ. /
;
ÕÕ/ 0
Color32
ŒŒ 
[
ŒŒ 
]
ŒŒ 
newpix
ŒŒ 
=
ŒŒ 
new
ŒŒ 
Color32
ŒŒ &
[
ŒŒ& '
orig
ŒŒ' +
.
ŒŒ+ ,
width
ŒŒ, 1
*
ŒŒ2 3
orig
ŒŒ4 8
.
ŒŒ8 9
height
ŒŒ9 ?
]
ŒŒ? @
;
ŒŒ@ A
int
œœ 
i
œœ 
=
œœ 
$num
œœ 
;
œœ 
for
–– 
(
–– 
int
–– 
c
–– 
=
–– 
$num
–– 
;
–– 
c
–– 
<
–– 
orig
––  
.
––  !
height
––! '
;
––' (
c
––) *
++
––* ,
)
––, -
{
—— 	
for
““ 
(
““ 
int
““ 
r
““ 
=
““ 
$num
““ 
;
““ 
r
““ 
<
““ 
orig
““  $
.
““$ %
width
““% *
;
““* +
r
““, -
++
““- /
)
““/ 0
{
”” 
newpix
‘‘ 
[
‘‘ 
orig
‘‘ 
.
‘‘ 
width
‘‘ !
*
‘‘" #
orig
‘‘$ (
.
‘‘( )
height
‘‘) /
-
‘‘0 1
(
‘‘2 3
orig
‘‘3 7
.
‘‘7 8
height
‘‘8 >
*
‘‘? @
r
‘‘A B
+
‘‘C D
orig
‘‘E I
.
‘‘I J
height
‘‘J P
)
‘‘P Q
+
‘‘R S
c
‘‘T U
]
‘‘U V
=
‘‘W X
origpix
‘‘Y `
[
‘‘` a
i
‘‘a b
]
‘‘b c
;
‘‘c d
i
’’ 
++
’’ 
;
’’ 
}
÷÷ 
}
◊◊ 	
	Texture2D
ÿÿ 
newtex
ÿÿ 
=
ÿÿ 
new
ÿÿ 
	Texture2D
ÿÿ (
(
ÿÿ( )
orig
ÿÿ) -
.
ÿÿ- .
height
ÿÿ. 4
,
ÿÿ4 5
orig
ÿÿ6 :
.
ÿÿ: ;
width
ÿÿ; @
,
ÿÿ@ A
orig
ÿÿB F
.
ÿÿF G
format
ÿÿG M
,
ÿÿM N
false
ÿÿO T
)
ÿÿT U
;
ÿÿU V
newtex
ŸŸ 
.
ŸŸ 
SetPixels32
ŸŸ 
(
ŸŸ 
newpix
ŸŸ !
,
ŸŸ! "
$num
ŸŸ# $
)
ŸŸ$ %
;
ŸŸ% &
newtex
⁄⁄ 
.
⁄⁄ 
Apply
⁄⁄ 
(
⁄⁄ 
)
⁄⁄ 
;
⁄⁄ 
return
€€ 
newtex
€€ 
;
€€ 
}
‹‹ 
}ﬁﬁ €/
}/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/PreferencesController.cs
public 
class !
PreferencesController "
:# $
MonoBehaviour% 2
{  
SingletonPreferences

 
sp

 
;

 
public 

CameraController 
cc 
; 
Dropdown 
dropdown 
; 
public 

Toggle 
feedback 
; 
public 

Dropdown 
dropdownYesNo !
;! "
public 

Dropdown 
dropdownSigns !
;! "
public 

PrincipalView 
pv 
; 
public 

NNModel 
model1 
; 
public 

NNModel 
model2 
; 
void 
Start	 
( 
) 
{ 
sp 

=  
SingletonPreferences !
.! "
Instance" *
;* +
sp 

.
 
	killModel 
( 
) 
; 
dropdown 
= 

GameObject 
. 
Find "
(" #
$str# -
)- .
.. /
GetComponent/ ;
<; <
Dropdown< D
>D E
(E F
)F G
;G H
}!! 
void$$ 
Update$$	 
($$ 
)$$ 
{%% 
if&& 

(&& 
feedback&& 
.&& 
IsActive&& 
(&& 
)&& 
)&&  
{'' 	
if(( 
((( 
feedback(( 
.(( 
isOn(( 
)(( 
sp(( !
.((! "
feedback((" *
=((+ ,
true((- 1
;((1 2
else)) 
sp)) 
.)) 
feedback)) 
=)) 
false)) $
;))$ %
}** 	
}++ 
public.. 

void.. 
	OpenPanel.. 
(.. 
).. 
{// 
pv00 

.00
 
	OpenPanel00 
(00 
)00 
;00 
}11 
public33 

void33 
setPreferences33 
(33 
)33  
{44 
sp55 

.55
 
	killModel55 
(55 
)55 
;55 
if66 

(66 
dropdown66 
.66 
options66 
[66 
dropdown66 %
.66% &
value66& +
]66+ ,
.66, -
text66- 1
==662 4
$str665 ?
)66? @
{77 	
sp88 
.88 
setValor88 
(88 
$num88 
)88 
;88 
sp99 
.99 
setModel99 
(99 
ModelLoader99 #
.99# $
Load99$ (
(99( )
model199) /
,99/ 0
verbose991 8
:998 9
false99: ?
)99? @
)99@ A
;99A B
}<< 	
else== 
if== 
(== 
dropdown== 
.== 
options== !
[==! "
dropdown==" *
.==* +
value==+ 0
]==0 1
.==1 2
text==2 6
====7 9
$str==: D
)==D E
{>> 	
sp?? 
.?? 
setValor?? 
(?? 
$num?? 
)?? 
;?? 
sp@@ 
.@@ 
setModel@@ 
(@@ 
ModelLoader@@ #
.@@# $
Load@@$ (
(@@( )
model2@@) /
,@@/ 0
verbose@@1 8
:@@8 9
false@@: ?
)@@? @
)@@@ A
;@@A B
}CC 	
spFF 

.FF
 
updateWorkerFF 
(FF 
)FF 
;FF 
ccKK 

.KK
 
backKK 
(KK 
)KK 
;KK 
}LL 
publicOO 

voidOO 
askQuestionOO 
(OO 
)OO 
{PP 
ifQQ 

(QQ 
dropdownYesNoQQ 
.QQ 
optionsQQ !
[QQ! "
dropdownYesNoQQ" /
.QQ/ 0
valueQQ0 5
]QQ5 6
.QQ6 7
textQQ7 ;
==QQ< >
$strQQ? C
)QQC D
{RR 	
pvSS 
.SS "
activateSecondQuestionSS %
(SS% &
trueSS& *
)SS* +
;SS+ ,
}TT 	
elseVV 
ifVV 
(VV 
dropdownYesNoVV 
.VV 
optionsVV &
[VV& '
dropdownYesNoVV' 4
.VV4 5
valueVV5 :
]VV: ;
.VV; <
textVV< @
==VVA C
$strVVD I
)VVI J
{WW 	
pvXX 
.XX "
activateSecondQuestionXX %
(XX% &
falseXX& +
)XX+ ,
;XX, -
}YY 	
}ZZ 
public\\ 

void\\ 
setFeedback\\ 
(\\ 
)\\ 
{]] 
if^^ 

(^^ 
dropdownYesNo^^ 
.^^ 
options^^ !
[^^! "
dropdownYesNo^^" /
.^^/ 0
value^^0 5
]^^5 6
.^^6 7
text^^7 ;
==^^< >
$str^^? D
)^^D E
{__ 	
cc`` 
.`` 
uploadImage`` 
(`` 
$str`` +
)``+ ,
;``, -
}aa 	
elsebb 
{cc 	
ccdd 
.dd 
uploadImagedd 
(dd 
dropdownSignsdd (
.dd( )
optionsdd) 0
[dd0 1
dropdownSignsdd1 >
.dd> ?
valuedd? D
]ddD E
.ddE F
textddF J
)ddJ K
;ddK L
}ee 	
ccff 

.ff
 
backff 
(ff 
)ff 
;ff 
}gg 
}hh ¬e
u/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/PrincipalView.cs
public 
class 
PrincipalView 
: 
MonoBehaviour *
{		 
public 

RawImage 

background 
; 
public 


GameObject 
predictionPanel %
;% &
public 

Text 
prediction_text_1 !
;! "
public 

Text 
prediction_text_2 !
;! "
public 

Text 
prediction_text_3 !
;! "
public 

Image 
prediction_img_1 !
;! "
public 

Image 
prediction_img_2 !
;! "
public 

Image 
prediction_img_3 !
;! "
public 


GameObject 
preferencesPanel &
;& '
public 


GameObject 
feedbackPanel #
;# $
public 


GameObject 
cam 
; 
public 


GameObject 
back 
; 
public 


GameObject 
preferences !
;! "
public 


GameObject 
give_feedback #
;# $
public 

Dropdown 
dropdownYesNo !
;! "
public 


GameObject 
secondQuestion $
;$ %
public   


GameObject   
dropdownOpt   !
;  ! "
public!! 


GameObject!! 
feedback_text!! #
;!!# $ 
SingletonPreferences## 
sp## 
;## 
public$$ 

Text$$ 
duration$$ 
;$$ 
string&& 

filePath&& 
;&& 
void)) 
Start))	 
()) 
))) 
{** 
filePath++ 
=++ 
Application++ 
.++ 
persistentDataPath++ 1
+++2 3
$str++4 E
;++E F
sp,, 

=,,  
SingletonPreferences,, !
.,,! "
Instance,," *
;,,* +
}-- 
void00 
Update00	 
(00 
)00 
{11 
}33 
public66 

void66 
	BackToCam66 
(66 
WebCamTexture66 '
webCamTexture66( 5
)665 6
{77 
predictionPanel88 
.88 
	SetActive88 !
(88! "
false88" '
)88' (
;88( )
preferencesPanel99 
.99 
	SetActive99 "
(99" #
false99# (
)99( )
;99) *
feedbackPanel:: 
.:: 
	SetActive:: 
(::  
true::  $
)::$ %
;::% &
};; 
public== 

void== 
backFunction== 
(== 
WebCamTexture== *
webCamTexture==+ 8
)==8 9
{>> 

background?? 
.?? 
texture?? 
=?? 
webCamTexture?? *
;??* +
predictionPanel@@ 
.@@ 
	SetActive@@ !
(@@! "
false@@" '
)@@' (
;@@( )
preferencesPanelAA 
.AA 
	SetActiveAA "
(AA" #
falseAA# (
)AA( )
;AA) *
feedbackPanelBB 
.BB 
	SetActiveBB 
(BB  
falseBB  %
)BB% &
;BB& '"
activateSecondQuestionCC 
(CC 
falseCC $
)CC$ %
;CC% &
dropdownOptDD 
.DD 
GetComponentDD  
<DD  !
DropdownDD! )
>DD) *
(DD* +
)DD+ ,
.DD, -
valueDD- 2
=DD3 4
$numDD5 6
;DD6 7
dropdownYesNoEE 
.EE 
valueEE 
=EE 
$numEE 
;EE  
enableButtonsFF 
(FF 
)FF 
;FF 
}GG 
publicJJ 

voidJJ 
SetPredictionTextsJJ "
(JJ" #
doubleJJ# )
[JJ) *
]JJ* +
	best_idxsJJ, 5
,JJ5 6
doubleJJ7 =
[JJ= >
]JJ> ?

best_probsJJ@ J
,JJJ K

DictionaryJJL V
<JJV W
intJJW Z
,JJZ [
stringJJ\ b
>JJb c
idx_to_labelsJJd q
)JJq r
{KK 
predictionPanelLL 
.LL 
	SetActiveLL !
(LL! "
trueLL" &
)LL& '
;LL' (
disableButtonsMM 
(MM 
)MM 
;MM 
prediction_text_1NN 
.NN 
textNN 
=NN  
$strNN! &
+NN' (
idx_to_labelsNN) 6
[NN6 7
(NN7 8
intNN8 ;
)NN; <
	best_idxsNN< E
[NNE F
$numNNF G
]NNG H
]NNH I
+NNJ K
$strNNL P
+NNQ R
(NNS T

best_probsNNT ^
[NN^ _
$numNN_ `
]NN` a
*NNb c
$numNNd g
)NNg h
.NNh i
ToStringNNi q
(NNq r
$strNNr v
)NNv w
+NNx y
$strNNz }
;NN} ~
prediction_text_2OO 
.OO 
textOO 
=OO  
$strOO! &
+OO' (
idx_to_labelsOO) 6
[OO6 7
(OO7 8
intOO8 ;
)OO; <
	best_idxsOO< E
[OOE F
$numOOF G
]OOG H
]OOH I
+OOJ K
$strOOL P
+OOQ R
(OOS T

best_probsOOT ^
[OO^ _
$numOO_ `
]OO` a
*OOb c
$numOOd g
)OOg h
.OOh i
ToStringOOi q
(OOq r
$strOOr v
)OOv w
+OOx y
$strOOz }
;OO} ~
prediction_text_3PP 
.PP 
textPP 
=PP  
$strPP! &
+PP' (
idx_to_labelsPP) 6
[PP6 7
(PP7 8
intPP8 ;
)PP; <
	best_idxsPP< E
[PPE F
$numPPF G
]PPG H
]PPH I
+PPJ K
$strPPL P
+PPQ R
(PPS T

best_probsPPT ^
[PP^ _
$numPP_ `
]PP` a
*PPb c
$numPPd g
)PPg h
.PPh i
ToStringPPi q
(PPq r
$strPPr v
)PPv w
+PPx y
$strPPz }
;PP} ~
prediction_img_1RR 
.RR 
GetComponentRR %
<RR% &
ImageRR& +
>RR+ ,
(RR, -
)RR- .
.RR. /
spriteRR/ 5
=RR6 7
(RR8 9
SpriteRR9 ?
)RR? @
	ResourcesRR@ I
.RRI J
LoadRRJ N
(RRN O
	best_idxsRRO X
[RRX Y
$numRRY Z
]RRZ [
.RR[ \
ToStringRR\ d
(RRd e
)RRe f
,RRf g
typeofRRh n
(RRn o
SpriteRRo u
)RRu v
)RRv w
;RRw x
prediction_img_2SS 
.SS 
GetComponentSS %
<SS% &
ImageSS& +
>SS+ ,
(SS, -
)SS- .
.SS. /
spriteSS/ 5
=SS6 7
(SS8 9
SpriteSS9 ?
)SS? @
	ResourcesSS@ I
.SSI J
LoadSSJ N
(SSN O
	best_idxsSSO X
[SSX Y
$numSSY Z
]SSZ [
.SS[ \
ToStringSS\ d
(SSd e
)SSe f
,SSf g
typeofSSh n
(SSn o
SpriteSSo u
)SSu v
)SSv w
;SSw x
prediction_img_3TT 
.TT 
GetComponentTT %
<TT% &
ImageTT& +
>TT+ ,
(TT, -
)TT- .
.TT. /
spriteTT/ 5
=TT6 7
(TT8 9
SpriteTT9 ?
)TT? @
	ResourcesTT@ I
.TTI J
LoadTTJ N
(TTN O
	best_idxsTTO X
[TTX Y
$numTTY Z
]TTZ [
.TT[ \
ToStringTT\ d
(TTd e
)TTe f
,TTf g
typeofTTh n
(TTn o
SpriteTTo u
)TTu v
)TTv w
;TTw x
ifVV 

(VV 
!VV 
FileVV 
.VV 
ExistsVV 
(VV 
filePathVV !
)VV! "
)VV" #
{WW 	
varXX 
writerXX 
=XX 
newXX 
BinaryWriterXX )
(XX) *
FileXX* .
.XX. /
OpenXX/ 3
(XX3 4
filePathXX4 <
,XX< =
FileModeXX> F
.XXF G
	CreateNewXXG P
)XXP Q
)XXQ R
;XXR S
usingYY 
(YY 
writerYY 
)YY 
{ZZ 
writer[[ 
.[[ 
Write[[ 
([[ 
$str[[ &
+[[' (
DateTime[[) 1
.[[1 2
Now[[2 5
)[[5 6
;[[6 7
}\\ 
}]] 	
else^^ 
{__ 	
var`` 
writer`` 
=`` 
new`` 
BinaryWriter`` )
(``) *
File``* .
.``. /
Open``/ 3
(``3 4
filePath``4 <
,``< =
FileMode``> F
.``F G
Open``G K
)``K L
)``L M
;``M N
usingaa 
(aa 
writeraa 
)aa 
{bb 
writercc 
.cc 
Writecc 
(cc 
$strcc &
+cc' (
DateTimecc) 1
.cc1 2
Nowcc2 5
)cc5 6
;cc6 7
}dd 
}ee 	
varff 
elapsedff 
=ff 
(ff 
DateTimeff 
.ff  
Nowff  #
-ff$ %
spff& (
.ff( )
	startTimeff) 2
)ff2 3
.ff3 4
Millisecondsff4 @
;ff@ A
durationgg 
.gg 
textgg 
=gg 
elapsedgg 
.gg  
ToStringgg  (
(gg( )
)gg) *
;gg* +
}hh 
publicjj 

voidjj 
	OpenPaneljj 
(jj 
)jj 
{kk 
preferencesPanelll 
.ll 
	SetActivell "
(ll" #
truell# '
)ll' (
;ll( )
disableButtonsmm 
(mm 
)mm 
;mm 
}nn 
publicpp 

voidpp 
enableButtonspp 
(pp 
)pp 
{qq 
camrr 
.rr 
	SetActiverr 
(rr 
truerr 
)rr 
;rr 
backss 
.ss 
	SetActivess 
(ss 
truess 
)ss 
;ss 
preferencestt 
.tt 
	SetActivett 
(tt 
truett "
)tt" #
;tt# $
give_feedbackuu 
.uu 
	SetActiveuu 
(uu  
trueuu  $
)uu$ %
;uu% &
feedback_textvv 
.vv 
	SetActivevv 
(vv  
truevv  $
)vv$ %
;vv% &
}ww 
publicyy 

voidyy 
disableButtonsyy 
(yy 
)yy  
{zz 
cam{{ 
.{{ 
	SetActive{{ 
({{ 
false{{ 
){{ 
;{{ 
back|| 
.|| 
	SetActive|| 
(|| 
false|| 
)|| 
;|| 
preferences}} 
.}} 
	SetActive}} 
(}} 
false}} #
)}}# $
;}}$ %
give_feedback~~ 
.~~ 
	SetActive~~ 
(~~  
false~~  %
)~~% &
;~~& '
feedback_text 
. 
	SetActive 
(  
false  %
)% &
;& '
}
ÄÄ 
public
ÇÇ 

void
ÇÇ $
activateSecondQuestion
ÇÇ &
(
ÇÇ& '
bool
ÇÇ' +
activate
ÇÇ, 4
)
ÇÇ4 5
{
ÉÉ 
if
ÑÑ 

(
ÑÑ 
activate
ÑÑ 
)
ÑÑ 
{
ÖÖ 	
secondQuestion
ÜÜ 
.
ÜÜ 
	SetActive
ÜÜ $
(
ÜÜ$ %
true
ÜÜ% )
)
ÜÜ) *
;
ÜÜ* +
dropdownOpt
áá 
.
áá 
	SetActive
áá !
(
áá! "
true
áá" &
)
áá& '
;
áá' (
}
àà 	
else
ââ 
{
ää 	
secondQuestion
ãã 
.
ãã 
	SetActive
ãã $
(
ãã$ %
false
ãã% *
)
ãã* +
;
ãã+ ,
dropdownOpt
åå 
.
åå 
	SetActive
åå !
(
åå! "
false
åå" '
)
åå' (
;
åå( )
}
çç 	
}
éé 
}èè ß 
|/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/SingletonPreferences.cs
public 
class  
SingletonPreferences !
:" #
MonoBehaviour$ 1
{ 
private 
static  
SingletonPreferences '
sp( *
=+ ,
null- 1
;1 2
public 

int 
valor 
; 
public 

Model 
model 
; 
public 

IWorker 
worker 
; 
public 

DateTime 
	startTime 
; 
public 

bool 
feedback 
= 
true 
;  
public 

static  
SingletonPreferences &
Instance' /
{ 
get 
{ 	
if 
( 
sp 
== 
null 
) 
{ 
sp 
= 
FindObjectOfType %
<% & 
SingletonPreferences& :
>: ;
(; <
)< =
;= >
if!! 
(!! 
sp!! 
==!! 
null!! 
)!! 
{## 

GameObject$$ 
go$$ !
=$$" #
new$$$ '

GameObject$$( 2
($$2 3
)$$3 4
;$$4 5
go%% 
.%% 
name%% 
=%% 
$str%% 3
;%%3 4
sp&& 
=&& 
go&& 
.&& 
AddComponent&& (
<&&( ) 
SingletonPreferences&&) =
>&&= >
(&&> ?
)&&? @
;&&@ A
DontDestroyOnLoad(( %
(((% &
go((& (
)((( )
;(() *
})) 
}** 
return++ 
sp++ 
;++ 
},, 	
}-- 
private00 
void00 
Awake00 
(00 
)00 
{11 
if22 

(22 
sp22 
!=22 
null22 
&&22 
sp22 
!=22 
this22  $
)22$ %
{33 	
Destroy44 
(44 
this44 
.44 

gameObject44 #
)44# $
;44$ %
}55 	
else77 
{88 	
sp99 
=99 
this99 
;99 
DontDestroyOnLoad:: 
(:: 
this:: "
.::" #

gameObject::# -
)::- .
;::. /
};; 	
}<< 
void@@ 
Start@@	 
(@@ 
)@@ 
{AA 
}CC 
voidFF 
UpdateFF	 
(FF 
)FF 
{GG 
}II 
publicKK 

voidKK 
updateWorkerKK 
(KK 
)KK 
{LL 
workerMM 
=MM 
WorkerFactoryMM 
.MM 
CreateWorkerMM +
(MM+ ,
spMM, .
.MM. /
modelMM/ 4
,MM4 5
verboseMM6 =
:MM= >
falseMM? D
)MMD E
;MME F
}NN 
publicPP 

voidPP 
	killModelPP 
(PP 
)PP 
{QQ 
ifRR 

(RR
 
workerRR 
!=RR 
nullRR 
)RR 
{SS 	
workerTT 
.TT 
DisposeTT 
(TT 
)TT 
;TT 
workerUU 
=UU 
nullUU 
;UU 
}VV 	
}XX 
publicZZ 

voidZZ 
setValorZZ 
(ZZ 
intZZ 
vZZ 
)ZZ  
{[[ 
sp\\ 

.\\
 
valor\\ 
=\\ 
v\\ 
;\\ 
}]] 
public__ 

void__ 
setModel__ 
(__ 
Model__ 
m__  !
)__! "
{`` 
modelaa 
=aa 
maa 
;aa 
}bb 
}cc ë'
s/Users/inesmora/Documents/TFG/CNN-in-mobile-device-master/UnityProject/ProjectUpdated/Assets/Scripts/UpdateImage.cs
public 
class 
UpdateImage 
: 
MonoBehaviour (
{ 
void

 
Start

	 
(

 
)

 
{ 
} 
void 
Update	 
( 
) 
{ 
} 
public 

void 
StartUpload 
( 
	Texture2D %
image& +
,+ ,
String- 3

prediction4 >
,> ?
String@ F
user_predictionG V
,V W
boolX \
feedback] e
)e f
{ 
StartCoroutine 
( 
UploadCoroutine &
(& '
image' ,
,, -

prediction. 8
,8 9
user_prediction: I
,I J
feedbackK S
)S T
)T U
;U V
} 
private 
IEnumerator 
UploadCoroutine '
(' (
	Texture2D( 1
image2 7
,7 8
String9 ?

prediction@ J
,J K
StringL R
user_predictionS b
,b c
boold h
feedbacki q
)q r
{ 
var 
storage 
= 
FirebaseStorage %
.% &
DefaultInstance& 5
;5 6
StorageReference 
imageReference '
;' (
if 

( 
feedback 
&& 
user_prediction '
!=( *
$str+ ;
); <
{ 	
imageReference!! 
=!! 
storage!! $
.!!$ %
GetReference!!% 1
(!!1 2
$"!!2 4
$str!!4 >
{!!> ?
user_prediction!!? N
}!!N O
$str!!O P
{!!P Q
Guid!!Q U
.!!U V
NewGuid!!V ]
(!!] ^
)!!^ _
}!!_ `
$str!!` d
"!!d e
)!!e f
;!!f g
}"" 	
else## 
if## 
(## 
feedback## 
&&## 
user_prediction## ,
==##- /
$str##0 @
)##@ A
{$$ 	
imageReference&& 
=&& 
storage&& $
.&&$ %
GetReference&&% 1
(&&1 2
$"&&2 4
$str&&4 >
{&&> ?

prediction&&? I
}&&I J
$str&&J K
{&&K L
Guid&&L P
.&&P Q
NewGuid&&Q X
(&&X Y
)&&Y Z
}&&Z [
$str&&[ _
"&&_ `
)&&` a
;&&a b
}'' 	
else(( 
{)) 	
imageReference++ 
=++ 
storage++ $
.++$ %
GetReference++% 1
(++1 2
$"++2 4
$str++4 @
{++@ A
Guid++A E
.++E F
NewGuid++F M
(++M N
)++N O
}++O P
$str++P T
"++T U
)++U V
;++V W
},, 	
var-- 
bytes-- 
=-- 
image-- 
.-- 
EncodeToPNG-- %
(--% &
)--& '
;--' (
var.. 

uploadTask.. 
=.. 
imageReference.. '
...' (
PutBytesAsync..( 5
(..5 6
bytes..6 ;
)..; <
;..< =
yield// 
return// 
new// 
	WaitUntil// "
(//" #
(//# $
)//$ %
=>//& (

uploadTask//) 3
.//3 4
IsCompleted//4 ?
)//? @
;//@ A
if00 

(00 

uploadTask00 
.00 
	Exception00  
!=00! #
null00$ (
)00( )
{11 	
Debug22 
.22 
Log22 
(22 
$str22 /
+220 1

uploadTask222 <
.22< =
	Exception22= F
)22F G
;22G H
yield33 
break33 
;33 
}44 	
var66 

getUrlTask66 
=66 
imageReference66 '
.66' (
GetDownloadUrlAsync66( ;
(66; <
)66< =
;66= >
yield77 
return77 
new77 
	WaitUntil77 "
(77" #
(77# $
)77$ %
=>77& (

getUrlTask77) 3
.773 4
IsCompleted774 ?
)77? @
;77@ A
if99 

(99 

getUrlTask99 
.99 
	Exception99  
!=99! #
null99$ (
)99( )
{:: 	
Debug;; 
.;; 
Log;; 
(;; 
$str;; 1
+;;2 3

getUrlTask;;4 >
.;;> ?
	Exception;;? H
);;H I
;;;I J
yield<< 
break<< 
;<< 
}== 	
}>> 
}?? 